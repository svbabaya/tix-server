# camera-server
# libevent
Для многопоточности в libevent рекомендуется создавать отдельный event_base для каждого рабочего потока. На Linux самый эффективный способ распределения нагрузки между потоками — использование флага сокета SO_REUSEPORT, который позволяет нескольким потокам слушать один и тот же порт.

Инициализация потоков: Перед использованием libevent в многопоточном режиме (если вы используете один event_base на всех) нужно вызвать evthread_use_pthreads(). В примере выше это не обязательно, так как у каждого потока свой event_base.

SO_REUSEPORT: Этот флаг ядра Linux позволяет системе автоматически балансировать входящие TCP-соединения между потоками без использования мьютексов на этапе accept.

Компиляция: При сборке обязательно линкуйте библиотеки:
gcc main.c -levent -levent_pthreads -lpthread -o camera_server.
# libmicrohttpd
Использование libmicrohttpd (MHD) имеет встроенную поддержку пула потоков. Не нужно вручную управлять pthread_create для каждого запроса — библиотека сама распределяет задачи.
Преимущества для IP-камер
Минимальный размер: Библиотека практически не имеет зависимостей (только libc и опционально GnuTLS).
Простой API: Текстовые команды (API) обрабатываются одной функцией-колбэком.
Стабильность: MHD эффективно управляет памятью, что критично для встраиваемых Linux-систем.
Минимальный пример сервера с пулом потоков
Этот код создает сервер, который слушает порт 8888 и использует пул из 4 потоков для обработки запросов.

Разбор флагов для многопоточности:
MHD_USE_INTERNAL_POLLING_THREAD: Сервер работает "в фоне" в собственном потоке (или потоках), не блокируя основной поток main.
MHD_OPTION_THREAD_POOL_SIZE: Позволяет задать фиксированное количество потоков. Это лучший вариант для камер, так как ограничивает потребление ресурсов CPU. The GNU libmicrohttpd Manual.
MHD_USE_THREAD_PER_CONNECTION: Если вы не знаете заранее количество клиентов, этот флаг будет создавать новый поток для каждого нового подключения.

Сборка
Для сборки под Linux используйте:
gcc server.c -lmicrohttpd -o camera_api
Нужно ли добавить в пример парсинг параметров из URL (например, /api/set_ptz?x=10&y=20) для вашего текстового API?
